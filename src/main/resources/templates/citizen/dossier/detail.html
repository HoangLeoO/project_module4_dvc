<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{citizen/layout/fragments :: head('Chi tiết hồ sơ ' + ${d.dossierCode})}"></head>

<body class="bg-light d-flex flex-column min-vh-100">

    <nav th:replace="~{citizen/layout/fragments :: header('hoso')}"></nav>

    <!-- CONTENT -->
    <main class="container mt-5 pt-5 mb-5">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a th:href="@{/}" class="text-decoration-none text-muted">Trang chủ</a></li>
                <li class="breadcrumb-item"><a th:href="@{/citizen/hoso/danh-sach}"
                        class="text-decoration-none text-muted">Hồ sơ của tôi</a></li>
                <li class="breadcrumb-item active text-primary fw-bold" th:text="'Chi tiết ' + ${d.dossierCode}">
                    G01-2405001</li>
            </ol>
        </nav>

        <div class="row g-4">
            <!-- Left: Info -->
            <div class="col-lg-8">
                <!-- Status Banner -->
                <div class="card card-modern border-0 shadow-sm p-4 mb-4"
                    th:classappend="${d.dossierStatus == 'APPROVED' ? 'border-start border-5 border-success' : (d.dossierStatus == 'REJECTED' ? 'border-start border-5 border-danger' : 'border-start border-5 border-primary')}">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h4 class="fw-bold text-dark mb-1" th:text="${d.serviceName}">Đăng ký khai sinh</h4>
                            <div class="d-flex gap-3 align-items-center">
                                <span class="fw-bold text-primary" th:text="${d.dossierCode}">G01-2405001</span>
                                <span class="text-muted small">|</span>
                                <span class="text-muted small"><i class="bi bi-calendar-event me-1"></i>Ngày nộp: <span
                                        th:text="${#temporals.format(d.submissionDate, 'dd/MM/yyyy HH:mm')}">15/05/2024</span></span>
                            </div>
                        </div>
                        <div class="text-end">
                            <span th:if="${d.dossierStatus == 'NEW'}"
                                class="badge bg-primary bg-opacity-10 text-primary border border-primary px-3 py-2 rounded-pill fw-bold">Hồ
                                sơ mới</span>
                            <span th:if="${d.dossierStatus == 'PENDING'}"
                                class="badge bg-info bg-opacity-10 text-info border border-info px-3 py-2 rounded-pill fw-bold">Đang
                                xử lý</span>
                            <span th:if="${d.dossierStatus == 'NEED_SUPPLEMENT'}"
                                class="badge bg-warning bg-opacity-10 text-warning border border-warning px-3 py-2 rounded-pill fw-bold">Cần
                                bổ sung</span>
                            <span th:if="${d.dossierStatus == 'APPROVED'}"
                                class="badge bg-success bg-opacity-10 text-success border border-success px-3 py-2 rounded-pill fw-bold">Đã
                                hoàn tất</span>
                            <span th:if="${d.dossierStatus == 'REJECTED'}"
                                class="badge bg-danger bg-opacity-10 text-danger border border-danger px-3 py-2 rounded-pill fw-bold">Từ
                                chối</span>
                        </div>
                    </div>
                </div>

                <!-- History Timeline -->
                <div class="card card-modern border-0 shadow-sm p-4 mb-4">
                    <h5 class="fw-bold text-dark mb-4 border-start border-4 border-primary ps-3">Lịch sử xử lý</h5>
                    <div class="history-timeline">
                        <div th:each="log : ${history}" class="d-flex gap-3 mb-4 last-no-border">
                            <div class="flex-shrink-0 text-center" style="width: 60px;">
                                <div class="small fw-bold text-dark"
                                    th:text="${#temporals.format(log.createdAt, 'dd/MM')}">15/05</div>
                                <div class="small text-muted" th:text="${#temporals.format(log.createdAt, 'HH:mm')}">
                                    14:30</div>
                            </div>
                            <div class="flex-grow-1 ps-3 border-start position-relative">
                                <i class="bi bi-circle-fill text-primary position-absolute"
                                    style="left: -6px; top: 5px; font-size: 10px;"></i>
                                <h6 class="fw-bold text-dark mb-1">Cập nhật hồ sơ</h6>
                                <p class="small text-muted mb-1" th:text="${log.comments}">Hồ sơ đã được cán bộ Nguyễn
                                    Văn B tiếp nhận và chuyển phòng chuyên môn.</p>
                                <div class="small text-primary fw-medium" th:if="${log.actorName != null}">
                                    <i class="bi bi-person-check me-1"></i>Người xử lý: <span
                                        th:text="${log.actorName}">Nguyễn Văn B</span>
                                </div>
                            </div>
                        </div>
                        <div th:if="${history == null or history.isEmpty()}" class="text-center py-4 text-muted small">
                            Chưa có lịch sử xử lý cho hồ sơ này.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Details -->
            <div class="col-lg-4">
                <div class="card card-modern border-0 shadow-sm p-4 sticky-top" style="top: 100px;">
                    <h5 class="fw-bold text-dark mb-3">Thông tin chi tiết</h5>
                    <div class="mb-4">
                        <label class="small text-muted d-block opacity-75">Họ và tên người nộp</label>
                        <span class="fw-bold" th:text="${d.applicantFullName}">Nguyễn Văn A</span>
                    </div>
                    <div class="mb-4">
                        <label class="small text-muted d-block opacity-75">Ngày nộp hồ sơ</label>
                        <span class="fw-bold"
                            th:text="${#temporals.format(d.submissionDate, 'dd/MM/yyyy HH:mm')}">15/05/2024 14:30</span>
                    </div>
                    <div class="mb-4">
                        <label class="small text-muted d-block opacity-75">Mã số hồ sơ</label>
                        <span class="fw-bold font-monospace" th:text="${d.dossierCode}">G01-2405001</span>
                    </div>
                    <hr class="opacity-10">
                </div>
            </div>
        </div>
    </main>

    <footer th:replace="~{citizen/layout/fragments :: footer}"></footer>

</body>

</html>