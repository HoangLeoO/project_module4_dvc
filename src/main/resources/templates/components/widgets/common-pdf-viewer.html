<!-- 
    COMPONENT: COMMON PDF VIEWER 
    ID: #commonPdfViewer
    Location: components/widgets/common-pdf-viewer.html
    Usage: Load inside an iframe or include via JS.
    Query Params: ?file=URL&status=DRAFT|SIGNED
-->
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer</title>
    <!-- Core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            overflow: hidden;
            background: #525659;
        }

        /* Watermark Style */
        .watermark-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 5rem;
            font-weight: bold;
            color: rgba(220, 53, 69, 0.15);
            /* Red transparent */
            pointer-events: none;
            /* Click through */
            z-index: 10;
            white-space: nowrap;
            border: 5px solid rgba(220, 53, 69, 0.15);
            padding: 1rem 3rem;
            text-transform: uppercase;
        }

        .pdf-container {
            height: calc(100vh - 50px);
            /* Minus toolbar height */
            width: 100%;
            position: relative;
        }
    </style>
</head>

<body>

    <!-- 1. TOOLBAR CONTROLS -->
    <div class="d-flex justify-content-between align-items-center bg-dark text-white p-2" style="height: 50px;">
        <div class="d-flex align-items-center gap-2">
            <span class="small fw-bold ms-2"><i class="bi bi-file-earmark-pdf me-1"></i><span
                    id="fileName">tailieu.pdf</span></span>
        </div>

        <div class="d-flex align-items-center gap-2">
            <button class="btn btn-sm btn-outline-light border-0" title="Thu nhỏ" onclick="simulateZoomOut()"><i
                    class="bi bi-dash-lg"></i></button>
            <span class="small" id="zoomLevel">100%</span>
            <button class="btn btn-sm btn-outline-light border-0" title="Phóng to" onclick="simulateZoomIn()"><i
                    class="bi bi-plus-lg"></i></button>
            <div class="vr mx-1 bg-secondary"></div>
            <button class="btn btn-sm btn-outline-light border-0" title="Xoay trái" onclick="rotatePreview()"><i
                    class="bi bi-arrow-counterclockwise"></i></button>
        </div>

        <div>
            <a href="#" id="downloadLink" class="btn btn-sm btn-primary" download>
                <i class="bi bi-download me-1"></i>Tải về
            </a>
        </div>
    </div>

    <!-- 2. VIEW CANVAS / EMBED -->
    <div class="pdf-container bg-secondary d-flex justify-content-center align-items-center position-relative">

        <!-- Placeholder for PDF Embed -->
        <!-- Note: Modern browsers handle PDF embedding natively. For styling/control, libraries like PDF.js are better, 
             but for this simulation, we use <embed> or <iframe> -->
        <embed id="pdfEmbed" src="" type="application/pdf" width="100%" height="100%" class="bg-white shadow">

        <!-- 3. OVERLAY WATERMARK -->
        <div id="watermark" class="watermark-overlay d-none">
            BẢN THẢO
        </div>

        <!-- Fallback Message -->
        <div id="fallbackMsg" class="d-none text-center text-white">
            <p>Trình duyệt không hỗ trợ xem trực tiếp.</p>
            <a href="#" class="btn btn-light btn-sm">Tải file về máy</a>
        </div>
    </div>

    <!-- JS Logic -->
    <script>
        // Parse Query Params to Mock Data
        const urlParams = new URLSearchParams(window.location.search);
        const fileUrl = urlParams.get('file') || 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'; // Demo PDF
        const status = urlParams.get('status') || 'NONE'; // DRAFT, SIGNED, REJECTED
        const fileName = urlParams.get('name') || 'tailieu_mau.pdf';

        // 1. Init Data
        document.getElementById('fileName').textContent = fileName;
        document.getElementById('pdfEmbed').src = fileUrl;
        document.getElementById('downloadLink').href = fileUrl;

        // 2. Handle Watermark
        const watermarkEl = document.getElementById('watermark');
        if (status === 'DRAFT') {
            watermarkEl.textContent = 'DỰ THẢO - CHƯA KÝ';
            watermarkEl.classList.remove('d-none');
            watermarkEl.style.color = 'rgba(108, 117, 125, 0.2)';
            watermarkEl.style.borderColor = 'rgba(108, 117, 125, 0.2)';
        } else if (status === 'SIGNED') {
            watermarkEl.textContent = 'ĐÃ KÝ DUYỆT';
            watermarkEl.classList.remove('d-none');
            watermarkEl.style.color = 'rgba(25, 135, 84, 0.2)'; // Green
            watermarkEl.style.borderColor = 'rgba(25, 135, 84, 0.2)';
        } else if (status === 'REJECTED') {
            watermarkEl.textContent = 'ĐÃ TRẢ LẠI';
            watermarkEl.classList.remove('d-none');
        }

        // 3. Mock Controls (Zoom/Rotate - Visual only as <embed> is limited)
        function simulateZoomIn() {
            alert('Chức năng Zoom (Giả lập): Tỉ lệ 125%');
            document.getElementById('zoomLevel').textContent = '125%';
        }
        function simulateZoomOut() {
            alert('Chức năng Zoom (Giả lập): Tỉ lệ 75%');
            document.getElementById('zoomLevel').textContent = '75%';
        }
        function rotatePreview() {
            alert('Chức năng Xoay (Giả lập)');
        }
    </script>
</body>

</html>