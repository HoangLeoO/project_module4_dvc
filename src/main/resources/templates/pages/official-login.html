<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập Nội bộ - Hệ thống Một cửa Điện tử</title>

    <!-- Core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/internal.css">

    <style>
        .login-cover {
            background: url('https://source.unsplash.com/random/1920x1080/?government,building,architecture') center/cover no-repeat;
            position: relative;
        }

        .login-cover::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(13, 110, 253, 0.6), rgba(13, 202, 240, 0.4));
        }

        .login-container {
            min-height: 100vh;
        }
    </style>
</head>

<body>

    <div class="row g-0 login-container">

        <!-- 1. LEFT: COVER IMAGE -->
        <div class="col-lg-7 col-xl-8 d-none d-lg-block login-cover">
            <div class="d-flex h-100 align-items-center justify-content-center position-relative text-white p-5">
                <div class="text-center" style="z-index: 2;">
                    <h1 class="display-4 fw-bold mb-3">HỆ THỐNG MỘT CỬA ĐIỆN TỬ</h1>
                    <p class="lead">Nền tảng Quản lý Hành chính Công Tập trung</p>
                </div>
            </div>
        </div>

        <!-- 2. RIGHT: LOGIN FORM -->
        <div class="col-12 col-lg-5 col-xl-4 bg-white d-flex align-items-center justify-content-center shadow-lg">
            <div class="w-75">

                <!-- BRAND SYSTEM INFO -->
                <div class="text-center mb-5">
                    <img src="../../assets/img/logo-gov.png" alt="Quốc huy" style="height: 80px;" class="mb-3 d-none">
                    <!-- Placeholder for Logo -->
                    <i class="bi bi-bank fs-1 text-primary mb-3 d-block"></i> <!-- Icon thay thế nếu chưa có ảnh -->
                    <h3 class="fw-bold text-uppercase text-primary">Cổng Dịch Vụ Công</h3>
                    <p class="text-muted small">DÀNH CHO CÁN BỘ & CHUYÊN VIÊN</p>
                </div>

                <!-- Alert Error -->
                <div th:if="${param.error}" class="alert alert-danger d-flex align-items-center mb-4" role="alert">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <div class="small fw-bold ms-2">Tên đăng nhập hoặc mật khẩu không đúng</div>
                </div>

                <!-- Alert Logout -->
                <div th:if="${param.logout}" class="alert alert-success d-flex align-items-center mb-4" role="alert">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <div class="small fw-bold ms-2">Đã đăng xuất thành công</div>
                </div>

                <!-- FORM CREDENTIALS -->
                <form id="internalLoginForm" th:action="@{/process-login-official}" method="post"
                    onsubmit="return validateCaptcha(event)">

                    <!-- Username -->
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="username" name="username"
                            placeholder="Tên đăng nhập" required>
                        <label for="username"><i class="bi bi-person me-2"></i>Tên đăng nhập</label>
                    </div>

                    <!-- Password -->
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" id="password" name="password" placeholder="Mật khẩu"
                            required>
                        <label for="password"><i class="bi bi-lock me-2"></i>Mật khẩu</label>
                    </div>

                    <!-- SECURITY MOCK CAPTCHA -->
                    <div class="mb-4">
                        <label class="form-label small text-muted">Mã xác nhận an toàn</label>
                        <div class="input-group">
                            <span class="input-group-text fw-bold bg-light text-primary user-select-none">12 + 5 =
                                ?</span>
                            <input type="number" class="form-control" id="captcha" placeholder="Nhập kết quả" required>
                        </div>
                        <div id="captchaError" class="text-danger small mt-1 d-none">Kết quả phép tính không đúng!</div>
                    </div>

                    <!-- ACTION LOGIN BTN -->
                    <button type="submit" class="btn btn-primary w-100 py-2 fw-bold text-uppercase shadow-sm">
                        Đăng nhập vào hệ thống
                    </button>

                </form>

                <!-- FOOTER SUPPORT -->
                <div class="text-center mt-4 border-top pt-3">
                    <p class="small text-muted mb-0">
                        <i class="bi bi-shield-lock-fill me-1"></i>
                        Quên mật khẩu? Liên hệ Quản trị viên (Ext: <strong>101</strong>)
                    </p>
                    <p class="small text-danger fst-italic mt-1" style="font-size: 0.75rem;">
                        * Hệ thống giám sát chặt chẽ mọi lần đăng nhập.
                    </p>
                </div>

            </div>
        </div>
    </div>

    <!-- Script Logic -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function validateCaptcha(event) {
            // Không preventDefault ngay lập tức, chỉ prevent khi lỗi

            const captcha = document.getElementById('captcha').value;
            const captchaError = document.getElementById('captchaError');
            const btn = event.target.querySelector('button[type="submit"]');

            // 1. Validate Captcha (12 + 5 = 17)
            if (parseInt(captcha) !== 17) {
                event.preventDefault(); // Chặn submit
                captchaError.classList.remove('d-none');
                document.getElementById('captcha').classList.add('is-invalid');
                return false;
            } else {
                captchaError.classList.add('d-none');
                document.getElementById('captcha').classList.remove('is-invalid');

                // Show loading
                btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Đang xác thực...';
                // Không disable button để form có thể submit được (nếu disable input sẽ không gửi đi đôi khi)
                // Tuy nhiên với type=submit form vẫn gửi. Nhưng để an toàn ta chỉ đổi text.

                return true; // Cho phép submit form
            }
        }
    </script>
</body>

</html>