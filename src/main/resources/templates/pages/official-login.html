<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập Cán bộ | Hệ thống Thông tin Một cửa Điện tử</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        :root {
            --primary-gov: #003366;
            /* Deep Government Blue */
            --accent-gov: #d4af37;
            /* Muted Gold */
            --bg-light: #f8f9fa;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            /* Removed fixed height/overflow to allow scrolling on small screens if needed */
            min-height: 100vh;
        }

        .login-wrapper {
            min-height: 100vh;
            width: 100vw;
        }

        /* Left Side: Hero/Branding */
        .login-sidebar {
            /* Linear Gradient Overlay + Background Image */
            background: linear-gradient(135deg, rgba(0, 51, 102, 0.85) 0%, rgba(0, 31, 63, 0.95) 100%),
                url('https://source.unsplash.com/random/1920x1080/?government,architecture,vietnam');
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 4rem;
            color: white;
        }

        .login-sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            /* Subtle pattern overlay */
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            pointer-events: none;
        }

        .hero-title {
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .glass-badge {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 8px 16px;
            display: inline-block;
            margin-bottom: 2rem;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-gov);
        }

        /* Right Side: Form */
        .login-main {
            background: white;
            display: flex;
            flex-direction: column;
            /* Stack for sticky footer */
            height: 100vh;
            overflow-y: auto;
            /* Enable vertical scroll */
        }

        .login-card {
            width: 100%;
            max-width: 420px;
            padding: 2rem;
            margin: auto;
            /* Center vertically and horizontally */
        }

        .brand-logo-text {
            color: var(--primary-gov);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: -0.5px;
            border-left: 5px solid var(--accent-gov);
            padding-left: 15px;
            line-height: 1.2;
        }

        .form-floating>.form-control:focus~label,
        .form-floating>.form-control:not(:placeholder-shown)~label {
            color: var(--primary-gov);
            font-weight: 600;
        }

        .form-control:focus {
            border-color: var(--primary-gov);
            box-shadow: 0 0 0 0.25rem rgba(0, 51, 102, 0.15);
        }

        .btn-gov {
            background-color: var(--primary-gov);
            border-color: var(--primary-gov);
            color: white;
            transition: all 0.3s ease;
        }

        .btn-gov:hover {
            background-color: #002244;
            transform: translateY(-1px);
        }

        .alert-custom {
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .official-warning {
            border-top: 4px solid #dc3545;
            background: #fff5f5;
            padding: 1rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #842029;
            margin-top: 2rem;
        }
    </style>
</head>

<body>

    <div class="row g-0 login-wrapper">

        <!-- 1. LEFT: OFFICIAL BRANDING (60%) -->
        <div class="col-lg-7 col-xl-8 d-none d-lg-flex login-sidebar">
            <div style="z-index: 2; max-width: 800px;">
                <div class="glass-badge">
                    <i class="bi bi-shield-check me-2"></i>Khu vực quản trị
                </div>
                <h1 class="display-3 hero-title mb-4">Hệ thống Thông tin<br>Giải quyết Thủ tục Hành chính</h1>
                <p class="lead mb-5 opacity-75">Nền tảng số hóa quy trình nghiệp vụ, nâng cao hiệu quả phục vụ người dân
                    và doanh nghiệp.</p>

                <div class="d-flex gap-4 opacity-75 small">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-shield-lock fs-4 me-2"></i>
                        <span>Bảo mật<br>Đa lớp</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-lightning-charge fs-4 me-2"></i>
                        <span>Xử lý<br>Tốc độ cao</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-graph-up-arrow fs-4 me-2"></i>
                        <span>Giám sát<br>Thời gian thực</span>
                    </div>
                </div>
            </div>

            <!-- Decorative circle -->
            <div
                style="position: absolute; bottom: -100px; right: -100px; width: 400px; height: 400px; border-radius: 50%; border: 40px solid rgba(255,255,255,0.03);">
            </div>
        </div>

        <!-- 2. RIGHT: LOGIN FORM (40%) -->
        <div class="col-12 col-lg-5 col-xl-4 login-main">
            <div class="login-card">

                <!-- Header -->
                <div class="mb-5">
                    <div class="d-flex align-items-center mb-4">
                        <i class="bi bi-building-fill-gear fs-1 text-primary me-3"
                            style="color: var(--primary-gov) !important;"></i>
                        <div class="brand-logo-text">
                            <div>CỔNG DỊCH VỤ CÔNG</div>
                            <div class="fw-light small text-secondary" style="letter-spacing: 2px;">INTERNAL PORTAL
                            </div>
                        </div>
                    </div>
                    <h4 class="fw-bold mb-1">Đăng nhập</h4>
                    <p class="text-muted small">Vui lòng sử dụng tài khoản công vụ được cấp.</p>
                </div>

                <!-- Alert Error -->
                <div th:if="${param.error}" class="alert alert-danger alert-custom d-flex align-items-center mb-4"
                    role="alert">
                    <i class="bi bi-exclamation-octagon-fill me-2 fs-5"></i>
                    <div>Thông tin đăng nhập không chính xác.</div>
                </div>

                <!-- Alert Logout -->
                <div th:if="${param.logout}" class="alert alert-success alert-custom d-flex align-items-center mb-4"
                    role="alert">
                    <i class="bi bi-check-circle-fill me-2 fs-5"></i>
                    <div>Đã đăng xuất phiên làm việc an toàn.</div>
                </div>

                <!-- FORM -->
                <form id="internalLoginForm" th:action="@{/process-login-official}" method="post"
                    onsubmit="return validateCaptcha(event)">

                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="username" name="username" placeholder="Tài khoản"
                            required>
                        <label for="username">Tài khoản cán bộ</label>
                    </div>

                    <div class="form-floating mb-4">
                        <input type="password" class="form-control" id="password" name="password" placeholder="Mật khẩu"
                            required>
                        <label for="password">Mật khẩu</label>
                    </div>

                    <!-- Captcha Section -->
                    <div class="mb-4 bg-light p-3 rounded border">
                        <label class="form-label small text-muted fw-bold mb-2">Xác thực an toàn</label>
                        <div class="d-flex align-items-center gap-2">
                            <span id="captchaLabel" class="badge bg-secondary fs-6 py-2 px-3 fw-normal"
                                style="min-width: 100px;">...</span>
                            <input type="number" class="form-control" id="captcha" placeholder="Nhập kết quả" required
                                style="max-width: 120px;">
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="initCaptcha()"
                                title="Đổi mã khác">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                        <div id="captchaError" class="text-danger small mt-2 d-none fw-bold">
                            <i class="bi bi-x-circle me-1"></i>Kết quả không đúng, vui lòng thử lại!
                        </div>
                    </div>

                    <button type="submit" class="btn btn-gov w-100 py-3 fw-bold text-uppercase shadow-sm mb-4">
                        Truy cập hệ thống
                    </button>

                    <div class="official-warning">
                        <div class="fw-bold mb-1"><i class="bi bi-shield-exclamation me-1"></i> CẢNH BÁO AN NINH</div>
                        Hệ thống này chỉ dành cho cán bộ, công chức được ủy quyền. Mọi hành vi truy cập trái phép đều bị
                        ghi lại và xử lý theo quy định của pháp luật.
                    </div>

                    <div class="text-center mt-4">
                        <a href="#" class="text-decoration-none small text-muted hover-link">Quên mật khẩu? Liên hệ IT
                            Helpdesk (1900 xxxx)</a>
                    </div>
                </form>
            </div>

            <div class="py-3 text-center bg-white border-top mt-auto">
                <small class="text-muted" style="font-size: 0.7rem;">&copy; 2024 Hệ thống Thông tin Chính quyền Điện tử.
                    All rights reserved.</small>
            </div>
        </div>
    </div>

    <!-- Script Logic -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let expectedCaptchaResult = 0;

        function initCaptcha() {
            const num1 = Math.floor(Math.random() * 10) + 1; // 1-10
            const num2 = Math.floor(Math.random() * 10) + 1; // 1-10
            expectedCaptchaResult = num1 + num2;
            const label = document.getElementById('captchaLabel');
            if (label) label.textContent = `${num1} + ${num2} = ?`;

            // Clear input
            const input = document.getElementById('captcha');
            if (input) input.value = '';
            input.classList.remove('is-invalid');
            document.getElementById('captchaError').classList.add('d-none');
        }

        // Initialize captcha on load
        document.addEventListener('DOMContentLoaded', initCaptcha);

        function validateCaptcha(event) {
            const captchaInput = document.getElementById('captcha');
            const captchaVal = captchaInput.value;
            const captchaError = document.getElementById('captchaError');
            const btn = event.target.querySelector('button[type="submit"]');

            // 1. Validate Captcha
            if (parseInt(captchaVal) !== expectedCaptchaResult) {
                event.preventDefault(); // Chặn submit
                captchaError.classList.remove('d-none');
                captchaInput.classList.add('is-invalid');
                initCaptcha(); // Reset captcha to prevent brute force
                return false;
            } else {
                captchaError.classList.add('d-none');
                captchaInput.classList.remove('is-invalid');

                // Show loading
                const originalText = btn.innerText;
                btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Đang xác thực...';

                // Allow submit
                return true;
            }
        }
    </script>
</body>