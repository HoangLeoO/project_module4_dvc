<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${s != null ? 'Nộp hồ sơ: ' + s.serviceName : 'Nộp Hồ sơ Trực tuyến'}">Nộp Hồ sơ Trực tuyến - Dịch
        vụ công Đà Nẵng</title>
    <!-- Core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
    <link rel="stylesheet" th:href="@{/assets/css/portal.css}">
    <style>
        .wizard-step {
            position: relative;
            z-index: 1;
        }

        .wizard-step .btn-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #dee2e6;
            background: white;
            font-weight: bold;
            color: #6c757d;
        }

        .wizard-step.active .btn-circle {
            border-color: var(--bs-primary);
            background: var(--bs-primary);
            color: white;
        }

        .wizard-connector {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #dee2e6;
            z-index: 0;
        }
    </style>
</head>

<body class="bg-light">

    <!-- 1. HEADER (Solid style for sub-pages) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm-soft py-3 bg-gradient-primary">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center fw-bold fs-4" th:href="@{/citizen/dashboard}">
                <i class="bi bi-bank2 me-2"></i>DỊCH VỤ CÔNG ĐÀ NẴNG
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#landingNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="landingNav">
                <ul class="navbar-nav ms-auto gap-3 mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link fw-medium hover-white"
                            th:classappend="${activePage == 'home'} ? 'active fw-bold border-bottom border-2 border-warning text-warning' : 'text-white-50'"
                            th:href="@{/citizen/dashboard}">Trang chủ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link fw-medium hover-white"
                            th:classappend="${activePage == 'hoso'} ? 'active fw-bold border-bottom border-2 border-warning text-warning' : 'text-white-50'"
                            th:href="@{/citizen/hoso}">Hồ sơ của tôi</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link fw-medium hover-white"
                            th:classappend="${activePage == 'services'} ? 'active fw-bold border-bottom border-2 border-warning text-warning' : 'text-white-50'"
                            th:href="@{/citizen/services}">Dịch vụ công</a>
                    </li>
                    <li class="nav-item"><a class="nav-link fw-medium text-white-50 hover-white" href="#">Hướng dẫn</a>
                    </li>
                    <li class="nav-item"><a class="nav-link fw-medium text-white-50 hover-white"
                            th:href="@{/citizen/feedback}">Phản ánh kiến nghị</a></li>
                </ul>
                <div class="ms-lg-4">
                    <!-- User Profile -->
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle"
                            data-bs-toggle="dropdown">
                            <img src="https://ui-avatars.com/api/?name=Le+Van+Dan&background=random"
                                class="rounded-circle me-2" width="32">
                            <span>Lê Văn Dân</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Thông tin cá nhân</a>
                            </li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-safe me-2"></i>Kho dữ
                                    liệu số</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item text-danger" href="#"><i
                                        class="bi bi-box-arrow-right me-2"></i>Đăng xuất</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="container mt-5 pt-5 mb-5">

        <!-- Page Title -->
        <div class="text-center mb-5">
            <h2 class="fw-bold text-primary mb-2">Nộp Hồ sơ Trực tuyến</h2>
            <p class="text-muted" id="serviceNameLabel"
                th:text="${s != null ? 'Thủ tục: ' + s.serviceName : 'Chọn thủ tục để tiếp tục'}">Thủ tục: Đăng ký khai
                sinh (Liên thông)</p>
        </div>

        <!-- 2. WIZARD NAV -->
        <div class="position-relative mb-5 mx-auto" style="max-width: 800px;">
            <div class="wizard-connector"></div>
            <div class="d-flex justify-content-between position-relative">

                <div class="wizard-step active" id="navStep1">
                    <div class="text-center">
                        <div class="btn-circle mx-auto mb-2">1</div>
                        <small class="fw-bold">Thông tin Người nộp</small>
                    </div>
                </div>

                <div class="wizard-step" id="navStep2">
                    <div class="text-center">
                        <div class="btn-circle mx-auto mb-2">2</div>
                        <small class="text-muted">Thông tin Tờ khai</small>
                    </div>
                </div>

                <div class="wizard-step" id="navStep3">
                    <div class="text-center">
                        <div class="btn-circle mx-auto mb-2">3</div>
                        <small class="text-muted">Thành phần Hồ sơ</small>
                    </div>
                </div>

                <div class="wizard-step" id="navStep4">
                    <div class="text-center">
                        <div class="btn-circle mx-auto mb-2">4</div>
                        <small class="text-muted">Lệ phí & Nộp</small>
                    </div>
                </div>

            </div>
        </div>

        <!-- WIZARD CONTENT -->
        <div class="card shadow-sm border-0 rounded-3 wizard-content mx-auto" style="max-width: 900px;">
            <div class="card-body p-4 p-lg-5">

                <!-- STEP 1: APPLICANT INFO -->
                <div id="step1">
                    <h5 class="fw-bold border-bottom pb-2 mb-4 text-primary">Bước 1: Thông tin Người nộp hồ sơ</h5>

                    <div class="alert alert-info border-0 shadow-sm d-flex align-items-center">
                        <i class="bi bi-info-circle-fill fs-4 me-3"></i>
                        <div>
                            Dữ liệu được tự động điền từ Cơ sở dữ liệu Quốc gia về Dân cư (VNeID).
                        </div>
                    </div>

                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label text-muted small text-uppercase fw-bold">Họ và tên</label>
                            <input type="text" class="form-control bg-light fw-bold text-primary" value="LÊ VĂN DÂN"
                                readonly>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small text-uppercase fw-bold">Số CCCD/Định danh</label>
                            <input type="text" class="form-control bg-light" value="048090000123" readonly>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small text-uppercase fw-bold">Ngày sinh</label>
                            <input type="text" class="form-control bg-light" value="01/01/1990" readonly>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small text-uppercase fw-bold">Điện thoại</label>
                            <input type="text" class="form-control bg-light" value="0905123456" readonly>
                        </div>
                        <div class="col-12">
                            <label class="form-label text-muted small text-uppercase fw-bold">Địa chỉ thường trú</label>
                            <input type="text" class="form-control bg-light"
                                value="123 Nguyễn Văn Linh, Q. Thanh Khê, TP. Đà Nẵng" readonly>
                        </div>
                    </div>

                    <!-- PROXY TOGGLE (SCENARIO 3) -->
                    <div class="bg-light p-3 rounded border">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="isProxy" onchange="toggleProxy()">
                            <label class="form-check-label fw-bold" for="isProxy">
                                Tôi nộp hồ sơ thay cho người khác (Được ủy quyền)
                            </label>
                        </div>

                        <!-- PROXY INPUT SECTION -->
                        <div id="proxySection" class="row g-3 mt-2 d-none border-top pt-3">
                            <div class="col-md-8">
                                <label class="form-label text-muted small">Nhập Số CCCD người ủy quyền</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="proxyCCCD"
                                        placeholder="VD: 00123456789">
                                    <button class="btn btn-outline-primary" type="button" onclick="checkProxy()">
                                        <i class="bi bi-search me-1"></i>Tra cứu
                                    </button>
                                </div>
                                <div id="proxyResult" class="mt-2 small"></div>
                            </div>
                            <div class="col-12 text-muted small fst-italic">
                                * Yêu cầu đính kèm Giấy ủy quyền hợp pháp ở Bước 3.
                            </div>
                        </div>
                    </div>

                </div>

                <!-- STEP 2: DYNAMIC FORM -->
                <div id="step2" class="d-none">
                    <h5 class="fw-bold border-bottom pb-2 mb-4 text-primary">Bước 2: Thông tin Tờ khai</h5>

                    <!-- FORM: BIRTH REGISTRATION (Default Demo) -->
                    <div id="formBirth">
                        <h6 class="fw-bold text-uppercase mb-3 text-secondary">A. Thông tin Trẻ sinh</h6>
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label class="form-label required">Họ và tên trẻ <span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control text-uppercase" placeholder="VD: LÊ VĂN A">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Giới tính <span class="text-danger">*</span></label>
                                <select class="form-select">
                                    <option>Nam</option>
                                    <option>Nữ</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ngày sinh <span class="text-danger">*</span></label>
                                <input type="date" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Dân tộc</label>
                                <input type="text" class="form-control" value="Kinh">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Nơi sinh (Cơ sở y tế)</label>
                                <input type="text" class="form-control"
                                    placeholder="VD: Bệnh viện Phụ sản - Nhi Đà Nẵng">
                            </div>
                        </div>

                        <h6 class="fw-bold text-uppercase mt-4 mb-3 text-secondary">B. Thông tin Cha/Mẹ</h6>
                        <div class="alert alert-warning border-0 small">
                            <i class="bi bi-lightning-charge-fill text-warning me-1"></i>
                            Thông tin Cha/Mẹ được tự động trích xuất từ CSDL Dân cư dựa trên quan hệ Vợ chồng.
                        </div>
                    </div>

                    <!-- FORM: LAND (Hidden by default, toggle via JS if needed) -->
                    <div id="formLand" class="d-none">
                        <h6 class="fw-bold text-uppercase mb-3 text-secondary">Chọn Thửa đất cần giao dịch</h6>
                        <!-- Asset Selector (Scenario 2) -->
                        <div class="row row-cols-1 row-cols-md-2 g-4">
                            <!-- Asset 1 -->
                            <div class="col">
                                <label class="card h-100 border-primary cursor-pointer shadow-sm">
                                    <div class="card-body">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="landAsset" checked>
                                            <h6 class="form-check-label fw-bold">Thửa đất số 12, Tờ bản đồ 05</h6>
                                        </div>
                                        <ul class="small text-muted mt-2 ps-4 mb-0">
                                            <li>Địa chỉ: Hòa Hải, Ngũ Hành Sơn</li>
                                            <li>Diện tích: 200m2 (ONT)</li>
                                            <li>Số GCN: B123456</li>
                                        </ul>
                                    </div>
                                </label>
                            </div>
                            <!-- Asset 2 -->
                            <div class="col">
                                <label class="card h-100 cursor-pointer text-muted bg-light">
                                    <div class="card-body">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="landAsset">
                                            <h6 class="form-check-label fw-bold">Thửa đất số 99 (Đang thế chấp)</h6>
                                        </div>
                                        <div class="badge bg-danger mt-2 ms-4">Đã bị khóa</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- STEP 3: UPLOAD ZONE -->
                <div id="step3" class="d-none">
                    <h5 class="fw-bold border-bottom pb-2 mb-4 text-primary">Bước 3: Thành phần Hồ sơ</h5>

                    <div class="border border-2 border-dashed p-5 text-center bg-light rounded-3 mb-4">
                        <i class="bi bi-cloud-arrow-up text-secondary" style="font-size: 3rem;"></i>
                        <h6 class="mt-3 fw-bold">Kéo thả file vào đây hoặc Chọn file từ máy</h6>
                        <p class="small text-muted">Hỗ trợ PDF, JPG, PNG. Tối đa 10MB/file.</p>

                        <div class="d-flex justify-content-center gap-2 mt-3">
                            <button class="btn btn-primary btn-sm rounded-pill px-3">
                                <i class="bi bi-folder2-open me-1"></i>Chọn file
                            </button>
                            <button class="btn btn-outline-secondary btn-sm rounded-pill px-3">
                                <i class="bi bi-safe me-1"></i>Kho dữ liệu (Vault)
                            </button>
                        </div>
                    </div>

                    <!-- File List Mock -->
                    <div class="list-group">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-file-earmark-pdf-fill text-danger fs-4 me-3"></i>
                                <div>
                                    <h6 class="mb-0 small fw-bold">To-khai-dang-ky.pdf <span
                                            class="badge bg-success ms-1">Auto-gen</span></h6>
                                    <small class="text-muted">1.2 MB - Tạo tự động từ Bước 2</small>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-link text-danger"><i class="bi bi-trash"></i></button>
                        </div>
                    </div>

                </div>

                <!-- STEP 4: PAYMENT & SUBMIT -->
                <div id="step4" class="d-none">
                    <h5 class="fw-bold border-bottom pb-2 mb-4 text-primary">Bước 4: Xác nhận & Nộp hồ sơ</h5>

                    <div class="alert alert-success border-0 shadow-sm text-center py-4">
                        <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
                        <h4 class="fw-bold mt-3">Hồ sơ đã sẵn sàng!</h4>
                        <p class="text-muted">Vui lòng kiểm tra lại thông tin trước khi nộp.</p>
                    </div>

                    <div class="bg-white p-3 border rounded mb-4">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Lệ phí thủ tục:</span>
                            <span class="fw-bold"
                                th:text="${s != null ? #numbers.formatDecimal(s.feeAmount, 0, 'COMMA', 0, 'POINT') + ' VNĐ' : '0 VNĐ'}">15,000
                                VNĐ</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Phí bưu chính:</span>
                            <span class="fw-bold">0 VNĐ</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between fs-5 fw-bold text-primary">
                            <span>Tổng cộng:</span>
                            <span
                                th:text="${s != null ? #numbers.formatDecimal(s.feeAmount, 0, 'COMMA', 0, 'POINT') + ' VNĐ' : '0 VNĐ'}">15,000
                                VNĐ</span>
                        </div>
                    </div>

                    <p class="text-center small text-muted">
                        Bằng việc nhấn "Nộp hồ sơ", bạn cam kết chịu trách nhiệm về tính chính xác của thông tin.
                    </p>

                </div>

                <!-- ACTION BUTTONS -->
                <div class="d-flex justify-content-between mt-5 pt-3 border-top">
                    <button class="btn btn-secondary px-4 disabled" id="btnBack" onclick="changeStep(-1)">
                        <i class="bi bi-arrow-left me-2"></i>Quay lại
                    </button>
                    <button class="btn btn-primary px-4 fw-bold" id="btnNext" onclick="changeStep(1)">
                        Tiếp tục <i class="bi bi-arrow-right ms-2"></i>
                    </button>
                </div>

            </div>
        </div>

    </main>

    <!-- FOOTER -->
    <footer class="bg-footer-dark text-white py-5 mt-auto">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-5">
                    <h5 class="fw-bold mb-4 text-uppercase text-white-50 small ls-1">Đơn vị vận hành</h5>
                    <div class="d-flex align-items-center mb-3">
                        <i class="bi bi-building fs-1 me-3 opacity-50"></i>
                        <div>
                            <h6 class="fw-bold mb-1">TRUNG TÂM HÀNH CHÍNH CÔNG</h6>
                            <p class="mb-0 small opacity-75">Thành phố Đà Nẵng</p>
                        </div>
                    </div>
                    <p class="small opacity-50">Hệ thống cung cấp dịch vụ công trực tuyến mức độ 3, 4 phục vụ người dân
                        và doanh nghiệp.</p>
                </div>
                <div class="col-md-3 offset-md-1">
                    <h5 class="fw-bold mb-4 text-uppercase text-white-50 small ls-1">Liên kết</h5>
                    <ul class="list-unstyled small opacity-75 d-flex flex-column gap-2">
                        <li><a href="#" class="text-white text-decoration-none hover-white"><i
                                    class="bi bi-chevron-right me-2"></i>Cổng thông tin Tp.</a></li>
                        <li><a href="#" class="text-white text-decoration-none hover-white"><i
                                    class="bi bi-chevron-right me-2"></i>Sở TT & TT</a></li>
                        <li><a href="#" class="text-white text-decoration-none hover-white"><i
                                    class="bi bi-chevron-right me-2"></i>Văn bản quy phạm</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5 class="fw-bold mb-4 text-uppercase text-white-50 small ls-1">Liên hệ</h5>
                    <p class="small opacity-75 mb-1"><i class="bi bi-geo-alt me-2"></i>24 Trần Phú, Hải Châu</p>
                    <p class="small opacity-75 mb-1"><i class="bi bi-telephone me-2"></i>(0236) 1022</p>
                    <p class="small opacity-75"><i class="bi bi-envelope me-2"></i>contact@danang.gov.vn</p>
                </div>
            </div>
            <hr class="opacity-10 my-4">
            <div class="text-center small opacity-50">
                &copy; 2025 E-Gov Simulation System (Static Prototype Mode)
            </div>
        </div>
    </footer>

    <!-- JS Logic -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        let currentStep = 1;

        // Handle Domain-specific logic if needed
        const domain = /*[[${s != null ? s.domain : ''}]]*/ '';
        if (domain === 'DATDAI' || domain === 'DAT_DAI') {
            document.getElementById('formBirth').classList.add('d-none');
            document.getElementById('formLand').classList.remove('d-none');
        }

        // NAVIGATION LOGIC
        function changeStep(n) {
            currentStep += n;
            if (currentStep < 1) currentStep = 1;
            if (currentStep > 4) currentStep = 4;
            updateWizardUI();
        }

        function updateWizardUI() {
            for (let i = 1; i <= 4; i++) {
                const el = document.getElementById(`step${i}`);
                const navEl = document.getElementById(`navStep${i}`);
                if (i === currentStep) {
                    el.classList.remove('d-none');
                    navEl.classList.add('active');
                } else {
                    el.classList.add('d-none');
                    navEl.classList.remove('active');
                }
            }

            const btnBack = document.getElementById('btnBack');
            const btnNext = document.getElementById('btnNext');

            if (currentStep === 1) {
                btnBack.classList.add('disabled');
            } else {
                btnBack.classList.remove('disabled');
            }

            if (currentStep === 4) {
                btnNext.innerHTML = '<i class="bi bi-send-fill me-2"></i>Nộp hồ sơ';
                btnNext.classList.remove('btn-primary');
                btnNext.classList.add('btn-success');
                btnNext.onclick = function () {
                    alert("Nộp hồ sơ thành công! Chuyển sang danh sách hồ sơ.");
                    window.location.href = '/citizen/hoso';
                };
            } else {
                btnNext.innerHTML = 'Tiếp tục <i class="bi bi-arrow-right ms-2"></i>';
                btnNext.classList.add('btn-primary');
                btnNext.classList.remove('btn-success');
                btnNext.onclick = function () { changeStep(1); };
            }
        }

        // PROXY LOGIC
        function toggleProxy() {
            const isChecked = document.getElementById('isProxy').checked;
            const section = document.getElementById('proxySection');
            if (isChecked) {
                section.classList.remove('d-none');
            } else {
                section.classList.add('d-none');
            }
        }

        function checkProxy() {
            const cccd = document.getElementById('proxyCCCD').value;
            const res = document.getElementById('proxyResult');
            res.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Đang tra cứu...';
            setTimeout(() => {
                if (cccd === '00123456789') {
                    res.innerHTML = '<span class="text-success fw-bold"><i class="bi bi-check-circle me-1"></i>Hợp lệ: Ông NGUYỄN VĂN HÙNG (Chủ hộ)</span>';
                } else {
                    res.innerHTML = '<span class="text-danger fw-bold"><i class="bi bi-x-circle me-1"></i>Không tìm thấy dữ liệu công dân này!</span>';
                }
            }, 1000);
        }
    </script>
</body>

</html>