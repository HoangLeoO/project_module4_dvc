<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bàn làm việc Lãnh đạo - Hệ thống Một cửa</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../../../static/assets/css/style.css">
    <link rel="stylesheet" href="../../../static/assets/css/internal.css">

    <style>
        :root {
            --primary-gov: #003366;
            --accent-gov: #d4af37;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f6f9;
        }

        .text-warning {
            color: var(--accent-gov) !important;
        }

        .hover-light:hover {
            color: white !important;
            background: rgba(255, 255, 255, 0.05);
        }
    </style>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-light">

    <!-- WRAPPER -->
    <div class="d-flex" id="wrapper" th:with="currentPage='dashboard'">

        <!-- SIDEBAR -->
        <div th:replace="~{pages/04-leader/fragments/leader-layout :: sidebar}"></div>

        <!-- MAIN CONTENT -->
        <div style="margin-left: 260px; width: calc(100% - 260px);" class="d-flex flex-column min-vh-100">

            <!-- HEADER -->
            <nav th:replace="~{pages/04-leader/fragments/leader-layout :: header}"></nav>

            <main class="flex-grow-1 p-4">



                <!-- KPI CARDS -->
                <div class="row row-cols-1 row-cols-md-5 g-3 mb-4">
                    <div class="col">
                        <div class="card bg-primary text-white border-0 shadow-sm h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="card-title mb-0">Chờ ký duyệt</h5>
                                    <i class="bi bi-pen fs-3 opacity-50"></i>
                                </div>
                                <h2 class="fw-bold mb-0" th:text="${pendingCount}">15</h2>
                                <small class="opacity-75">Hồ sơ cần xử lý hôm nay</small>
                            </div>
                            <a th:href="@{/leader/my-dossiers}"
                                class="card-footer bg-primary border-top border-white border-opacity-25 text-white text-decoration-none small">
                                Xem danh sách <i class="bi bi-arrow-right ms-1"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card bg-success text-white border-0 shadow-sm h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="card-title mb-0">Tỷ lệ đúng hạn</h5>
                                    <i class="bi bi-clock-history fs-3 opacity-50"></i>
                                </div>
                                <h2 class="fw-bold mb-0" th:text="${onTimeRate} + '%'">98.5%</h2>
                                <small class="opacity-75">Tăng 0.5% so với tháng trước</small>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card bg-info text-white border-0 shadow-sm h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="card-title mb-0">Mức độ hài lòng</h5>
                                    <i class="bi bi-emoji-smile-fill fs-3 opacity-50"></i>
                                </div>
                                <h2 class="fw-bold mb-0" th:text="${satisfactionScore} + '/5'">4.8/5</h2>
                                <small class="opacity-75">Dựa trên 1,200 lượt đánh giá</small>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card bg-warning text-dark border-0 shadow-sm h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="card-title mb-0">Tồn đọng quá hạn</h5>
                                    <i class="bi bi-hourglass-bottom fs-3 opacity-50"></i>
                                </div>
                                <h2 class="fw-bold mb-0" th:text="${overdueCount}">3</h2>
                                <small class="opacity-75">Hồ sơ trễ hạn > 24h</small>
                            </div>
                        </div>
                    </div>
                    <!-- New KPI: Delegated Dossiers -->
                    <div class="col">
                        <div class="card bg-secondary text-white border-0 shadow-sm h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="card-title mb-0">Được ủy quyền</h5>
                                    <i class="bi bi-shield-check fs-3 opacity-50"></i>
                                </div>
                                <h2 class="fw-bold mb-0" th:text="${delegatedCount}">0</h2>
                                <small class="opacity-75">Hồ sơ ủy quyền chờ xử lý</small>
                            </div>
                            <a th:href="@{/leader/delegated-dossiers}"
                                class="card-footer bg-secondary border-top border-white border-opacity-25 text-white text-decoration-none small">
                                Xem danh sách <i class="bi bi-arrow-right ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- CHARTS & LISTS -->
                <div class="row g-4">
                    <!-- PARETO CHART -->
                    <div class="col-lg-8">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-header bg-white fw-bold py-3">
                                <i class="bi bi-graph-up-arrow me-2"></i>Phân tích Nguyên nhân chậm trễ (Pareto)
                            </div>
                            <div class="card-body">
                                <canvas id="paretoChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- STAFF RANKING -->
                    <div class="col-lg-4">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-header bg-white fw-bold py-3">
                                <i class="bi bi-trophy-fill me-2 text-warning"></i>Xếp hạng Cán bộ
                            </div>
                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-warning rounded-pill me-2">#1</span>
                                        <img src="https://ui-avatars.com/api/?name=Le+Thi+A" class="rounded-circle me-2"
                                            width="30">
                                        <span>Lê Thị A</span>
                                    </div>
                                    <span class="fw-bold text-success">99%</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-secondary rounded-pill me-2">#2</span>
                                        <img src="https://ui-avatars.com/api/?name=Tran+Van+B"
                                            class="rounded-circle me-2" width="30">
                                        <span>Trần Văn B</span>
                                    </div>
                                    <span class="fw-bold text-success">98%</span>
                                </div>
                            </div>
                            <div class="card-header bg-white fw-bold py-3 border-top mt-auto">
                                <i class="bi bi-exclamation-octagon-fill me-2 text-danger"></i>Cảnh báo hiệu suất
                            </div>
                            <div class="list-group list-group-flush">
                                <div
                                    class="list-group-item d-flex justify-content-between align-items-center bg-danger bg-opacity-10">
                                    <div class="d-flex align-items-center">
                                        <img src="https://ui-avatars.com/api/?name=Nguyen+Van+C"
                                            class="rounded-circle me-2" width="30">
                                        <span>Nguyễn Văn C</span>
                                    </div>
                                    <span class="fw-bold text-danger">Quy tắc 4H</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- JS Logic -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Init Chart
        const ctx = document.getElementById('paretoChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Thiếu thành phần HS', 'Lỗi hệ thống', 'Phối hợp ngành chậm', 'Công dân chậm nộp phí', 'Khác'],
                datasets: [
                    {
                        label: 'Số lượng hồ sơ',
                        data: [45, 20, 15, 10, 5],
                        backgroundColor: '#0d6efd',
                        yAxisID: 'y',
                    },
                    {
                        label: 'Tích lũy %',
                        data: [47, 68, 84, 95, 100],
                        type: 'line',
                        borderColor: '#dc3545',
                        yAxisID: 'y1',
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        max: 100
                    }
                }
            }
        });
    </script>
</body>

</html>