<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Báo cáo Thống kê - Lãnh đạo</title>
    <!-- Core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../../../static/assets/css/style.css">
    <link rel="stylesheet" href="../../../static/assets/css/internal.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-gov: #003366;
            --accent-gov: #d4af37;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f6f9;
        }

        .text-warning {
            color: var(--accent-gov) !important;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-light">

    <!-- WRAPPER -->
    <div class="d-flex" id="wrapper" th:with="currentPage='reports'">

        <!-- SIDEBAR -->
        <div th:replace="~{pages/04-leader/fragments/leader-layout :: sidebar}"></div>

        <!-- MAIN CONTENT -->
        <div style="margin-left: 260px; width: calc(100% - 260px);" class="d-flex flex-column min-vh-100">

            <!-- HEADER -->
            <nav th:replace="~{pages/04-leader/fragments/leader-layout :: header}"></nav>

            <main class="flex-grow-1 p-4">

                <!-- TOOLBAR -->
                <!-- TOOLBAR -->
                <form action="/leader/reports" method="get" class="card border-0 shadow-sm mb-4">
                    <div class="card-body p-3 d-flex gap-3 align-items-end">
                        <div class="flex-grow-1">
                            <label class="form-label small fw-bold">Kỳ báo cáo</label>
                            <div class="d-flex gap-2">
                                <select name="periodType" class="form-select" onchange="this.form.submit()">
                                    <option value="MONTH" th:selected="${periodType == 'MONTH'}">Theo Tháng</option>
                                    <option value="QUARTER" th:selected="${periodType == 'QUARTER'}">Theo Quý</option>
                                    <option value="YEAR" th:selected="${periodType == 'YEAR'}">Theo Năm</option>
                                </select>
                                <select name="periodValue" class="form-select" style="width: 120px;"
                                    th:if="${periodType != 'YEAR'}">
                                    <option th:each="i : ${#numbers.sequence(1, 12)}" th:value="${i}" th:text="${i}"
                                        th:selected="${i == periodValue}" th:if="${periodType == 'MONTH'}"></option>
                                    <option th:each="i : ${#numbers.sequence(1, 4)}" th:value="${i}"
                                        th:text="'Quý ' + ${i}" th:selected="${i == periodValue}"
                                        th:if="${periodType == 'QUARTER'}"></option>
                                </select>
                                <input type="number" name="year" class="form-control" style="width: 100px;"
                                    th:value="${year}">
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <button type="submit" class="btn btn-primary fw-bold btn-sm mt-4">Xem báo cáo</button>
                        </div>
                        <button type="button" class="btn btn-success fw-bold"><i
                                class="bi bi-file-earmark-excel me-2"></i>Xuất Excel</button>
                    </div>
                </form>

                <!-- TABS & CHART -->
                <div class="row g-4">
                    <div class="col-lg-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white fw-bold py-3">
                                <i class="bi bi-graph-up me-2"></i>Biểu đồ Xu hướng Hồ sơ
                            </div>
                            <div class="card-body">
                                <canvas id="trendChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- DATA SUMMARY -->
                    <div class="col-lg-4">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-header bg-white fw-bold py-3">
                                Tóm tắt Số liệu (<span th:text="${summary.periodName}">Tháng 12</span>)
                            </div>
                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex justify-content-between">
                                    <span>Tiếp nhận mới:</span>
                                    <strong class="text-primary" th:text="${summary.totalReceived}">0</strong>
                                </div>
                                <div class="list-group-item d-flex justify-content-between">
                                    <span>Đã giải quyết:</span>
                                    <strong class="text-success" th:text="${summary.totalResolved}">0</strong>
                                </div>
                                <div class="list-group-item d-flex justify-content-between">
                                    <span>Đúng hạn:</span>
                                    <strong th:text="${summary.getOnTimeRate() + '%'}">100%</strong>
                                </div>
                                <div class="list-group-item d-flex justify-content-between bg-danger bg-opacity-10">
                                    <span>Trả lại / Từ chối:</span>
                                    <strong class="text-danger" th:text="${summary.totalRejected}">0</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DETAILED TABLE -->
                <div class="card border-0 shadow-sm mt-4">
                    <div class="card-header bg-white fw-bold py-3">
                        Chi tiết theo Lĩnh vực
                    </div>
                    <div class="card-body p-0">
                        <table class="table table-bordered table-striped mb-0">
                            <thead class="bg-light text-center">
                                <tr>
                                    <th>Lĩnh vực</th>
                                    <th>Tiếp nhận</th>
                                    <th>Đang xử lý</th>
                                    <th>Đã xong</th>
                                    <th>Tỷ lệ đúng hạn</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${domainStats}">
                                    <td class="fw-bold" th:text="${item.domain}">Lĩnh vực</td>
                                    <td class="text-end" th:text="${item.totalReceived}">0</td>
                                    <td class="text-end" th:text="${item.processing}">0</td>
                                    <td class="text-end" th:text="${item.completed}">0</td>
                                    <td class="text-center fw-bold"
                                        th:classappend="${item.getOnTimeRate() >= 95} ? 'text-success' : 'text-warning'"
                                        th:text="${item.getOnTimeRate() + '%'}">100%</td>
                                </tr>
                                <tr th:if="${domainStats.isEmpty()}">
                                    <td colspan="5" class="text-center text-muted py-3">Không có số liệu trong kỳ này
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- JS Logic -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const ctx = document.getElementById('trendChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Tuần 1', 'Tuần 2', 'Tuần 3', 'Tuần 4'],
                datasets: [{
                    label: 'Tháng 12/2025',
                    data: [350, 420, 380, 450],
                    borderColor: '#0d6efd',
                    tension: 0.3,
                    fill: false
                },
                {
                    label: 'Tháng 11/2025',
                    data: [300, 380, 350, 400],
                    borderColor: '#adb5bd',
                    borderDash: [5, 5],
                    tension: 0.3,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    </script>
</body>

</html>